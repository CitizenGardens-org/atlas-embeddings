name: AEP CI Gates
on:
  push:
  pull_request:
jobs:
  ci-gates:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with: { python-version: "3.11" }
      - name: Install
        run: |
          pip install -e .
          pip install pytest
      - name: Run unit tests
        run: pytest -q
      - name: Prepare kernel.atlas
        run: |
          mkdir -p examples/aep_unity_neutral
          echo "KERNEL_PLACEHOLDER" > examples/aep_unity_neutral/kernel.atlas
      - name: CI Gates
        run: |
          python -m atlas.ci.gates \
            --aep-toml examples/aep_unity_neutral/aep.toml \
            --witness  examples/aep_unity_neutral/witness.json \
            --kernel   examples/aep_unity_neutral/kernel.atlas \
            --Q 1000000
      - name: Upload artifacts
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: aep-artifacts
          path: artifacts/aep
